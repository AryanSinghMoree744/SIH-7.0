<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Attendance Details</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f6f9; }
    h1 { text-align: center; color: #333; }
    table { width: 80%; margin: auto; border-collapse: collapse; background: white; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    th, td { padding: 12px; text-align: center; border-bottom: 1px solid #ddd; }
    th { background-color: #2196F3; color: white; }
    tr:nth-child(even){background-color: #f2f2f2;}
    button { display: block; margin: 20px auto; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background-color: #45a049; }
  </style>
</head>
<body>
<h1>Student Attendance Details</h1>

<table id="attendanceTable">
  <thead>
    <tr>
      <th>Student Name</th>
      <th>Date</th>
      <th>Status</th>
      <th>Method</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button onclick="downloadCSV()">Export as CSV</button>

<script>
async function loadAttendance() {
  const res = await fetch('/api/attendance_summary/1'); // Adjust for student or all students
  const data = await res.json();
  const tbody = document.getElementById('attendanceTable').querySelector('tbody');
  tbody.innerHTML = '';
  
  // Mock: loop over Present/Absent counts
  let today = new Date().toISOString().slice(0,10);
  data.labels.forEach((label,index) => {
    let tr = document.createElement('tr');
    tr.innerHTML = `<td>Student 1</td><td>${today}</td><td>${label}</td><td>Face</td>`;
    tbody.appendChild(tr);
  });
}

function downloadCSV() {
  const rows = document.querySelectorAll('table tr');
  let csv = [];
  rows.forEach(row => {
    const cols = row.querySelectorAll('td,th');
    const rowData = [];
    cols.forEach(col => rowData.push(col.innerText));
    csv.push(rowData.join(','));
  });
  const csvContent = "data:text/csv;charset=utf-8," + csv.join("\n");
  const encodedUri = encodeURI(csvContent);
  const link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", "attendance_details.csv");
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

loadAttendance();
</script>
</body>
</html>
